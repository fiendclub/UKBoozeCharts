<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UK Booze Charts</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0/dist/css/bootstrap.min.css">
    <style>
        body {
            font-family: 'Arial', sans-serif;
            background-color: #f8f9fa;
            color: #495057;
            transition: background-color 0.3s, color 0.3s;
        }

        h1 {
            font-size: 2.5rem;
            color: #007BFF;
            margin-bottom: 20px;
        }

        .button-container {
            margin-bottom: 20px;
        }

        .button-container button {
            margin-right: 10px;
        }

        .toggle-dark-mode {
            background-color: #007BFF;
            color: #fff;
        }

        .toggle-dark-mode:hover {
            background-color: #0056b3;
        }

        .table-container {
            margin-bottom: 20px;
        }

        table {
            border-collapse: collapse;
            background-color: #fff;
            box-shadow: 0px 2px 10px rgba(0, 0, 0, 0.1);
        }

        th,
        td {
            padding: 15px;
            text-align: left;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            background-color: #fff; /* Added background color */
        }

        th {
            background-color: #007BFF;
            color: black;
            cursor: pointer;
        }

        th:hover {
            background-color: #0056b3;
        }

        .sort-arrow {
            margin-left: 5px;
        }

        .pagination {
            display: flex;
            justify-content: center;
            list-style: none;
            padding: 0;
        }

        .pagination li {
            margin: 0 5px;
        }

        .pagination a {
            text-decoration: none;
            padding: 8px 16px;
            border: 1px solid #007BFF;
            color: #007BFF;
            border-radius: 5px;
        }

        .pagination a:hover {
            background-color: #0056b3;
            color: #fff;
        }

        /* Dark mode styles */
        body.dark-mode {
            background-color: #343a40;
            color: #fff;
        }

        .table-container.dark-mode table {
            background-color: #495057;
            box-shadow: 0px 2px 10px rgba(255, 255, 255, 0.1);
        }

        .table-container.dark-mode th {
            background-color: #212529;
            color: #fff;
        }

        .table-container.dark-mode td {
            background-color: #343a40;
            color: #fff;
        }

        .pagination.dark-mode a {
            border: 1px solid #fff;
            color: #fff;
        }

        .pagination.dark-mode a:hover {
            background-color: #fff;
            color: #343a40;
        }

        .dark-mode .dark-mode-table-bordered th,
        .dark-mode .dark-mode-table-bordered td {
            background-color: #2f2f2f !important;
            color: #acacac !important;
        }


        .dropdown-menu {
            background-color: #cfcfcf !important;
        }

        .dark-mode .search-input,
        .dark-mode .search-input:hover,
        .dark-mode .search-input:focus {
            background-color: #333333;
            color: #b5b5b5;
            margin-bottom: 1rem;
            outline: none; /* Remove the default focus outline */
        }

        .search-input,
        .search-input:hover,
        .search-input:focus {
            margin-bottom: 1rem;
            outline: none; /* Remove the default focus outline */
        }

        .container {
            max-width: 90%; /* Adjust as needed */
            margin: 0 auto; /* Center the container */
        }

        /* Make the table and its columns wider */
        .table-container {
            overflow-x: auto; /* Enable horizontal scrolling if necessary */
        }

        .table-bordered th,
        .table-bordered td {
            min-width: 150px; /* Adjust as needed */
            text-align: center; /* Center align the text in the cells */
        }

        /* Optionally, make the search input wider */
        .search-input {
            width: 100%; /* Take up the full width of the container */
        }

        @media (max-width: 576px) {
            .pagination {
                flex-wrap: wrap;
            }

            .pagination li {
                margin: 5px 0;
            }

            .button-container button {
                margin-right: 10px;
                margin-bottom: 10px; /* Add margin-bottom for spacing */
            }
        }

    </style>
</head>

<body>


<div class="container">
    <h1 class="display-4" style="padding-top: 5rem; margin-bottom: -0.5rem;">UK Booze Charts</h1>
    <p style="font-weight: bold; font-size: 30px;">Get wasted for cheap!</p>

    <div class="button-container">
        <button class="btn btn-primary" onclick="loadData('https://corsproxy.org/?https://www.jsonkeeper.com/b/EDVC')">
            Cider
        </button>
        <div class="btn-group">
            <button class="btn btn-primary dropdown-toggle" data-toggle="dropdown" aria-haspopup="true"
                    aria-expanded="false">
                Beer
            </button>
            <div class="dropdown-menu">
                <button class="dropdown-item"
                        onclick="loadBeerData('https://corsproxy.org/?https://www.jsonkeeper.com/b/KTTQ', 'All Beers')">
                    All Beers
                </button>
                <div class="dropdown-divider"></div>
                <button class="dropdown-item"
                        onclick="loadBeerData('https://corsproxy.org/?https://www.jsonkeeper.com/b/KTTQ', 'Lager')">
                    Lager
                </button>
                <button class="dropdown-item"
                        onclick="loadBeerData('https://corsproxy.org/?https://www.jsonkeeper.com/b/KTTQ', 'Ale')">Ale
                </button>
                <button class="dropdown-item"
                        onclick="loadBeerData('https://corsproxy.org/?https://www.jsonkeeper.com/b/KTTQ', 'Stout')">
                    Stout
                </button>
                <button class="dropdown-item"
                        onclick="loadBeerData('https://corsproxy.org/?https://www.jsonkeeper.com/b/KTTQ', 'Craft')">
                    Craft
                </button>
            </div>
        </div>
        <button class="btn btn-primary" onclick="loadData('https://corsproxy.org/?https://www.jsonkeeper.com/b/SECG')">
            Vodka
        </button>
        <button class="btn btn-primary" onclick="loadData('https://corsproxy.org/?https://www.jsonkeeper.com/b/ICI3')">
            Gin
        </button>
        <button class="btn btn-primary" onclick="loadData('https://corsproxy.org/?https://www.jsonkeeper.com/b/1TB0')">
            Rum
        </button>
        <button class="btn btn-primary" onclick="loadData('https://corsproxy.org/?https://www.jsonkeeper.com/b/JFBI')">
            Wine
        </button>
        <button class="btn btn-primary" onclick="loadData('https://corsproxy.org/?https://www.jsonkeeper.com/b/VHN6')">
            Whiskey
        </button>
        <button class="btn toggle-dark-mode" style="background-color: #45a771; color: #141414; font-weight: bold;"
                onclick="toggleDarkMode()">Toggle Dark Mode
        </button>
    </div>

    <div class="form-group">
        <label for="searchInput">Search:</label>
        <input type="text" class="form-control search-input" id="searchInput" oninput="searchTable()">
    </div>

    <div class="table-container">
        <table class="table table-bordered">
            <thead>
            <tr>
                <th onclick="sortTable('product_name')" data-column="product_name">Product Name<span
                        class="sort-arrow">&#9650;&#9660;</span></th>
                <th onclick="sortTable('alcohol_content')" data-column="alcohol_content">Alcohol Content (%)<span
                        class="sort-arrow">&#9650;&#9660;</span></th>
                <th onclick="sortTable('ml_of_drink')" data-column="ml_of_drink">Volume (ml)<span
                        class="sort-arrow">&#9650;&#9660;</span></th>
                <th onclick="sortTable('total_alcohol_content_all_bottles')"
                    data-column="total_alcohol_content_all_bottles">Total Alcohol Content (all bottles)<span
                        class="sort-arrow">&#9650;&#9660;</span></th>
                <th onclick="sortTable('price.value')" data-column="price.value">Price (£)<span
                        class="sort-arrow">&#9650;&#9660;</span></th>
                <th onclick="sortTable('ranking')" data-column="ranking">Ranking<span
                        class="sort-arrow">&#9650;&#9660;</span></th>
                <th onclick="sortTable('place')" data-column="place">Place<span
                        class="sort-arrow">&#9650;&#9660;</span></th>
            </tr>
            </thead>
            <tbody id="productTableBody">
            </tbody>
        </table>
    </div>

    <ul class="pagination" id="pagination"></ul>
</div>

<script>
    async function loadData(url) {
        try {

            document.getElementById('searchInput').value = "";
            const response = await fetch(url);
            const jsonData = await response.json();

            const uniqueProductNames = new Set();

            const filteredData = jsonData.filter(item => {
                if (!uniqueProductNames.has(item.product_name)) {
                    uniqueProductNames.add(item.product_name);
                    return true;
                }
                return false;
            });

            data = filteredData;
            displayData(1);
            createPagination();

            return data;
        } catch (error) {
            console.error('Error loading data:', error);
            return [];
        }
    }

    async function loadBeerData(url, categoryFilter) {
        try {

            document.getElementById('searchInput').value = "";
            const response = await fetch(url);
            const jsonData = await response.json();

            let filteredData;

            if (categoryFilter === "All Beers") {
                filteredData = jsonData;
            } else if (categoryFilter === "Craft") {
                filteredData = jsonData.filter(item => {
                    if (!item.product_name.toLowerCase().includes("stout")) {
                        return (
                            item.product_name.toLowerCase().includes(categoryFilter.toLowerCase()) ||
                            item.product_name.toLowerCase().includes("ipa") ||
                            item.product_name.toLowerCase().includes("brewdog") ||
                            item.product_name.toLowerCase().includes("mixed pack")
                        );
                    }
                });
            } else {
                filteredData = jsonData.filter(item => {
                    if (!item.product_name.toLowerCase().includes("brewdog")) {
                        return item.product_name.toLowerCase().includes(categoryFilter.toLowerCase());
                    }
                });
            }

            filteredData.sort((a, b) => b.ranking - a.ranking);

            filteredData.forEach((item, index) => {
                item.place = (index + 1) + 'th';
            });

            data = filteredData;
            displayData(1);
            createPagination();

            return data;
        } catch (error) {
            console.error('Error loading data:', error);
            return [];
        }
    }

    function searchTable() {
        const searchInput = document.getElementById('searchInput').value.toLowerCase();

        const filteredData = data.filter(item => {
            return Object.values(item).some(value => {
                if (typeof value === 'string' && value.toLowerCase().includes(searchInput)) {
                    return true;
                }
                return false;
            });
        });

        displayData(1, filteredData);
        createPagination();
    }

    function clearAll() {
        data = [];
    }

    let data;
    const itemsPerPage = 10;
    let currentSortColumn = '';
    let isAscending = true;
    let uniqueProductNames = new Set();

    function displayData(page, filteredData = data) {
        const startIndex = (page - 1) * itemsPerPage;
        const endIndex = startIndex + itemsPerPage;
        const slicedData = filteredData.slice(startIndex, endIndex);

        const tableBody = document.getElementById('productTableBody');
        tableBody.innerHTML = '';

        slicedData.forEach(item => {
            const row = document.createElement('tr');
            row.innerHTML = `
<td><a href="https://www.amazon.co.uk${item.url}" target="_blank" style="text-decoration: none !important;">${truncateText(item.product_name)}</a></td>
<td>${item.alcohol_content}</td>
<td>${item.ml_of_drink}</td>
<td>${item.total_alcohol_content_all_bottles.toFixed(1)}</td>
<td>${item.price.currency}${item.price.value}</td>
<td>${item.ranking.toFixed(1)}</td>
<td>${item.place}</td>
        `;
            tableBody.appendChild(row);
        });
    }

    function createPagination() {
        const totalPages = Math.ceil(data.length / itemsPerPage);
        const pagination = document.getElementById('pagination');
        pagination.innerHTML = '';

        for (let i = 1; i <= totalPages; i++) {
            const li = document.createElement('li');
            const a = document.createElement('a');
            a.href = '#';
            a.textContent = i;
            a.addEventListener('click', () => {
                displayData(i);
            });
            li.appendChild(a);
            pagination.appendChild(li);
        }
    }

    function sortTable(column) {
        if (currentSortColumn === column) {
            isAscending = !isAscending;
        } else {
            currentSortColumn = column;
            isAscending = true;
        }

        updateSortArrows(column, isAscending);

        data.sort((a, b) => {
            const valueA = getValue(a, column);
            const valueB = getValue(b, column);

            if (column === 'ranking') {
                return isAscending ? valueA - valueB : valueB - valueA;
            } else if (column === 'place') {
                return isAscending ? comparePlace(valueA, valueB) : comparePlace(valueB, valueA);
            } else {
                return isAscending ? compareValues(valueA, valueB) : compareValues(valueB, valueA);
            }
        });

        displayData(1);
    }

    function compareValues(valueA, valueB) {
        if (typeof valueA === 'string' && typeof valueB === 'string') {
            return valueA.localeCompare(valueB);
        } else {
            return valueA - valueB;
        }
    }

    function comparePlace(a, b) {
        // Extract numeric and non-numeric parts
        const regex = /([0-9]+)([a-zA-Z]+)/;
        const matchA = a.match(regex);
        const matchB = b.match(regex);

        if (matchA && matchB) {
            const numericComparison = parseInt(matchA[1], 10) - parseInt(matchB[1], 10);
            return numericComparison === 0 ? matchA[2].localeCompare(matchB[2]) : numericComparison;
        } else {
            return compareValues(a, b);
        }
    }

    function getValue(obj, path) {
        const keys = path.split('.');
        return keys.reduce((acc, key) => (acc && acc[key] !== undefined ? acc[key] : undefined), obj);
    }

    function truncateText(text, maxLength = 50) {
        return text.length > maxLength ? text.slice(0, maxLength - 3) + '...' : text;
    }

    function updateSortArrows(column, isAscending) {
        const arrowElements = document.querySelectorAll('.sort-arrow');
        arrowElements.forEach(arrow => {
            arrow.textContent = '';
        });

        const currentSortArrow = document.querySelector(`th[data-column="${column}"] .sort-arrow`);
        currentSortArrow.textContent = isAscending ? '▲' : '▼';
    }

    async function initialize() {
        data = await loadData('https://corsproxy.org/?https://www.jsonkeeper.com/b/EDVC');
        displayData(1);
        createPagination();
    }

    function toggleDarkMode() {
        const body = document.body;
        body.classList.toggle('dark-mode');
        const isDarkMode = body.classList.contains('dark-mode');
        localStorage.setItem('darkMode', isDarkMode);
        const tableBorderedElements = document.querySelectorAll('.table-container .table-bordered');
        tableBorderedElements.forEach(element => {
            element.classList.toggle('dark-mode-table-bordered', isDarkMode);
        });
    }

    function applyStoredDarkMode() {
        const isDarkMode = localStorage.getItem('darkMode') === 'true';
        if (isDarkMode) {
            document.body.classList.add('dark-mode');
            const tableBorderedElements = document.querySelectorAll('.table-container .table-bordered');
            tableBorderedElements.forEach(element => {
                element.classList.toggle('dark-mode-table-bordered', isDarkMode);
            });
        }
    }

    applyStoredDarkMode();
    initialize();

</script>

<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>


</body>
</html>
